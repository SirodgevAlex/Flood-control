Привет!

Очевидно, что надо предложить лучшее по времени решение. Для этого я использовал Redis.

Используя своя алго прошлое я сразу понял, что надо использовать скользящее окно, в котором будем поддерживать запросы (userID и время запроса). Запросы будут отсортированы по времени (считаем. что их так подают в программу). Запрос подали - используем метод InsertRequest, который записывает запрос в конец скользящего окна, расширяя тем семым. То есть все запросы проходят через скользящее окно. Добавление запроса в окно происходит за O(1) в редисе. Само скользящее окно представлено в виде list в redis.

Дальше есть два варианта удаления этой записи:

1) Можно просто каждую секунду удалять записи, которые были более N секунд назад
2) Сделать отложенное удаление записи. То есть одновременно с созданием сделать отложенный на N секунд запуск этого же запроса.

   Удаление одной записи вне зависимости от случая происходит за O(1)

Сама Check это просто количество записей для данного userID в скользящем окне. Redis крутая штука, поэтому и эта операция происходит за O(1). 

Итоговая асимптотика O(M) где M - количетсво запросов.


P S я еще не доделал
